# This script fragment is used across our repos to set a variable "SetDevVersion" which
# is used when this pipeline is going to be generating and publishing daily dev builds.
parameters:
  ServiceDirectory: ''
steps:
- ${{if ne(parameters.ServiceDirectory, '')}}:
  - task: Powershell@2
    inputs:
      filePath: $(Build.SourcesDirectory)/eng/common/scripts/Save-Package-Properties.ps1
      arguments: >
        -ServiceDirectory ${{parameters.ServiceDirectory}}
        -OutDirectory $(Build.ArtifactStagingDirectory)/PackageInfo
      pwsh: true
      workingDirectory: $(Pipeline.Workspace)
    displayName: Dump Package properties
    condition: succeeded()
- pwsh: |
    Write-Host "SetDevVersion was: $('$(SetDevVersion)')"
    Write-Host "Build.Reason was: $(Build.Reason)"
    Write-Host "System.TeamProject was: $(System.TeamProject)"

    if (('$(SetDevVersion' -eq 'true') -or (('$(Build.Reason)' -in 'Schedule', 'IndividualCI') -and ('$(System.TeamProject)' -eq 'internal') -and ('$(SetDevVersion)' -ne 'false'))) {
      Write-Host "Setting VersioningProperties.UseDevVersions to true"
      echo "##vso[task.setvariable variable=UseDevVersions;isOutput=true]true"
    } else {
      Write-Host "Setting VersioningProperties.UseDevVersions to false."
      echo "##vso[task.setvariable variable=UseDevVersions;isOutput=true]false"
    }
  name: VersioningProperties
  displayName: "Setup Versioning Properties"